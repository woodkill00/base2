# FastAPI + Django Extension: Option 1 + Option B\n\n## Architecture Overview\n- **Django (Option 1)**: Owns the database schema, migrations, and admin UI. Runs as an internal-only service; Traefik exposes only guarded admin routes when enabled.\n- **FastAPI**: Public API runtime that talks to Postgres directly (no hard dependency on Django). All business/data access is implemented in FastAPI, mirroring Djangos schema at the DB level.\n- **React**: Public frontend; calls the API at `https://${WEBSITE_DOMAIN}/api/...`.\n- **Traefik**: Sole public entrypoint on ports 80/443. Handles TLS (staging-only ACME), routing, redirects, and security headers.\n\n## Routing (Option B: Traefik strips `/api`)\n- External clients call `https://${WEBSITE_DOMAIN}/api/...`.\n- Traefik router `api` matches `Host(${WEBSITE_DOMAIN}) && PathPrefix(/api)` and applies the `strip-api-prefix` middleware.\n- FastAPI receives routes **without** the `/api` prefix (e.g., `/health`, `/users/...`).\n- Internal-only services (Django, Postgres, Redis, Celery, nginx-static) never publish host ports; only Traefik exposes 80/443.\n\n## Health & Observability\n- FastAPI: `GET /health` (container healthcheck) and `GET /api/health` via Traefik.\n- Django: `GET /health` for runtime health, plus `manage.py check --deploy` in the container healthcheck.\n- Traefik: remote verification captures static/dynamic config, environment snapshot (with secrets redacted), and HTTP headers for `/` and `/api/health`.\n\n## Deployment Flow (High Level)\n- `./scripts/deploy.ps1` orchestrates DigitalOcean deploys (full or `-UpdateOnly`), validates DO credentials, runs remote verification, and saves artifacts under `local_run_logs/` (optionally timestamped).\n- Post-deploy verification (`./scripts/test.ps1`) checks:\n  - HTTPS homepage and `/api/health` reachability.\n  - Security headers and staging-only cert resolver (`le-staging`).\n  - Presence of key artifacts such as `compose-ps.txt`, `traefik-dynamic.yml`, and `django-migrate.txt`.\n\nFor detailed task breakdown and acceptance criteria, see `specs/001-fastapi-django-deploy/spec.md` and `specs/001-fastapi-django-deploy/tasks.md`.\n